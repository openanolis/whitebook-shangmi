<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Anolis OS å›½å¯†å¼€å‘æŒ‡å— - å•†ç”¨å¯†ç æŠ€æœ¯æœ€ä½³å®è·µç™½çš®ä¹¦</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="custom.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="overview.html">å‰è¨€</a></li><li class="chapter-item expanded "><a href="openanolis.html">OpenAnolis é¾™èœ¥ç¤¾åŒº</a></li><li class="chapter-item expanded "><a href="introduction.html">å›½å¯†ç®€ä»‹ä¸ç°çŠ¶</a></li><li class="chapter-item expanded "><a href="shangmi_sig.html">OpenAnolis å…¨æ ˆå›½å¯†æ¦‚è¿°</a></li><li class="chapter-item expanded "><a href="anolisos_guide.html" class="active">Anolis OS å›½å¯†å¼€å‘æŒ‡å—</a></li><li class="chapter-item expanded "><a href="trusted_computing.html">å›½å¯†å¯ä¿¡è®¡ç®—</a></li><li class="chapter-item expanded "><a href="secure_boot.html">å›½å¯†å®‰å…¨å¯åŠ¨</a></li><li class="chapter-item expanded "><a href="linux_kernel.html">Linux å†…æ ¸å›½å¯†æ”¯æŒ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="kernel_shangmi.html">å†…æ ¸å›½å¯†ç®—æ³•</a></li><li class="chapter-item expanded "><a href="kernel_fscrypt.html">æ–‡ä»¶åŠ å¯†ï¼ˆfscryptï¼‰</a></li><li class="chapter-item expanded "><a href="kernel_dmcrypt.html">ç£ç›˜åŠ å¯†ï¼ˆLUKSï¼‰</a></li><li class="chapter-item expanded "><a href="kernel_ima.html">å†…æ ¸å®Œæ•´æ€§åº¦é‡æ¶æ„ï¼ˆIMAï¼‰</a></li><li class="chapter-item expanded "><a href="kernel_modsign.html">å†…æ ¸æ¨¡å—ç­¾å</a></li><li class="chapter-item expanded "><a href="kernel_tls.html">Kernel TLSï¼ˆKTLSï¼‰å®è·µ</a></li></ol></li><li class="chapter-item expanded "><a href="tongsuo.html">Tongsuoï¼ˆé“œé”ï¼‰å¯†ç åº“</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tongsuo_tls.html">TLS 1.3 ä½¿ç”¨å•†å¯†å¥—ä»¶</a></li><li class="chapter-item expanded "><a href="tongsuo_dc.html">å§”æ‰˜å‡­è¯</a></li><li class="chapter-item expanded "><a href="tongsuo_cc.html">è¯ä¹¦å‹ç¼©ï¼ˆRFC 8879ï¼‰</a></li><li class="chapter-item expanded "><a href="tongsuo_tlcp.html">TLCP å®‰å…¨ä¼ è¾“åè®®</a></li><li class="chapter-item expanded "><a href="tongsuo_he.html">åŒæ€ç®—æ³•</a></li><li class="chapter-item expanded "><a href="tongsuo_java_sdk.html">Tongsuo-Java-SDK</a></li></ol></li><li class="chapter-item expanded "><a href="crypto_lib.html">OpenAnolis å›½å¯†ç®—æ³•åº“</a></li><li class="chapter-item expanded "><a href="dev_practices.html">å›½å¯†åº”ç”¨å¼€å‘å®è·µ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="python_shangmi.html">Python å›½å¯†ç­¾åå®è·µ</a></li><li class="chapter-item expanded "><a href="nginx_tlcp.html">Web æœåŠ¡å›½å¯†åŒè¯ä¹¦æ”¯æŒ</a></li></ol></li><li class="chapter-item expanded "><a href="optimization.html">å›½å¯†ç¡¬ä»¶åŠ é€Ÿä¸ä¼˜åŒ–</a></li><li class="chapter-item expanded affix "><a href="contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">å•†ç”¨å¯†ç æŠ€æœ¯æœ€ä½³å®è·µç™½çš®ä¹¦</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="anolis-os-å›½å¯†å¼€å‘æŒ‡å—"><a class="header" href="#anolis-os-å›½å¯†å¼€å‘æŒ‡å—">Anolis OS å›½å¯†å¼€å‘æŒ‡å—</a></h1>
<p>é¾™èœ¥ç¤¾åŒºä¸€ç›´è‡´åŠ›äºåœ¨æ“ä½œç³»ç»Ÿä¸­é›†æˆå›½å¯†çš„å…¨éƒ¨èƒ½åŠ›ï¼Œä»¥å¼€ç®±å³ç”¨ä½œä¸ºç›®æ ‡ï¼Œè®©ç”¨æˆ·å¯ä»¥å¦‚ä¸èˆ¬é¡ºæ»‘çš„ä»å›½é™…ç®—æ³•åˆ‡æ¢åˆ°å›½å¯†ç®—æ³•çš„ç”Ÿæ€ä¸Šï¼Œä¸ºæ­¤ï¼Œé¾™èœ¥ç¤¾åŒºåœ¨è¯¸å¤šçš„åŸºç¡€è½¯ä»¶ä¸­åšäº†å¾ˆå¤šçš„å…¼å®¹å’Œä¼˜åŒ–å·¥ä½œã€‚Linux å†…æ ¸å’Œ OpenSSL ä½œä¸ºå…¶ä¸­æœ€é‡è¦çš„é¡¹ç›®åšäº†å…¨é¢çš„å›½å¯†é€‚é…ï¼Œæœ¬ç« é‡ç‚¹ä»‹ç»é¾™èœ¥ç¤¾åŒºåœ¨ OpenSSL é€‚é…å›½å¯†ä¸Šçš„è¿›å±•ä»¥åŠç”¨æˆ·ä½¿ç”¨æŒ‡å—ã€‚</p>
<h2 id="openssl-11-å†…ç½®å®Œæ•´å›½å¯†èƒ½åŠ›"><a class="header" href="#openssl-11-å†…ç½®å®Œæ•´å›½å¯†èƒ½åŠ›">OpenSSL 1.1 å†…ç½®å®Œæ•´å›½å¯†èƒ½åŠ›</a></h2>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒOpenSSL æ˜¯æ“ä½œç³»ç»Ÿä¸­æœ€åŸºç¡€çš„å¯†ç å­¦å·¥å…·åº“ï¼Œå‡ ä¹è¢«é»˜è®¤é›†æˆåˆ°æ‰€æœ‰åŸºäºLinuxå’ŒBSDçš„å‘è¡Œç‰ˆä¸­ï¼Œä¸ºæ“ä½œç³»ç»Ÿæä¾›æœ€åŸºæœ¬çš„åŸºäºå¯†ç å­¦çš„ä¿¡æ¯å®‰å…¨èƒ½åŠ›ã€‚</p>
<p>OpenSSLæ•´ä¸ªè½¯ä»¶åŒ…å¤§æ¦‚å¯ä»¥åˆ†æˆä¸‰ä¸ªä¸»è¦çš„åŠŸèƒ½éƒ¨åˆ†ï¼šå¯†ç ç®—æ³•åº“ï¼ŒSSL/TLSåè®®åº“ä»¥åŠåº”ç”¨ç¨‹åºã€‚ä½œä¸ºä¸€ä¸ªåŸºäºå¯†ç å­¦çš„å®‰å…¨å¼€å‘åŒ…ï¼ŒOpenSSLæä¾›çš„åŠŸèƒ½ç›¸å½“å¼ºå¤§å’Œå…¨é¢ï¼Œå›Šæ‹¬äº†ä¸»è¦çš„å¯†ç ç®—æ³•ã€å¸¸ç”¨çš„å¯†é’¥å’Œè¯ä¹¦å°è£…ç®¡ç†åŠŸèƒ½ä»¥åŠ SSL/TLS åè®®ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„åº”ç”¨ç¨‹åºä¾›æµ‹è¯•æˆ–å…¶å®ƒç›®çš„ä½¿ç”¨ã€‚</p>
<blockquote>
<p>ğŸŸ¢ <strong>æŒ‘æˆ˜</strong></p>
</blockquote>
<p>OpenSSL 3.0
æ˜¯OpenSSLç¤¾åŒºçš„æœ€æ–°ç‰ˆæœ¬,äº2020å¹´4æœˆå‘å¸ƒï¼Œåˆ°ç›®å‰ä¸ºæ­¢å·²ç»å‘å¸ƒäº†å‡ ä¸ªç¨³å®šç‰ˆæœ¬ï¼Œå¾—ç›Šäºç¤¾åŒºå¼€å‘è€…çš„æŒç»­è´¡çŒ®ï¼Œè¿™ä¸ªç‰ˆæœ¬å·²ç»æ”¯æŒäº†å®Œæ•´çš„å›½å¯†èƒ½åŠ›ï¼ŒåŒ…æ‹¬SM2ã€SM3ã€SM4ç®—æ³•ä»¥åŠä½¿ç”¨è¿™äº›ç®—æ³•çš„å¯†é’¥å’Œè¯ä¹¦ä½“ç³»ï¼Œç”šè‡³æ˜¯SM3ã€SM4ç®—æ³•çš„ä¼˜åŒ–ä¹Ÿæœ‰äº†éƒ¨åˆ†æ¶æ„çš„æ”¯æŒã€‚</p>
<p>ç›¸è¾ƒäºåŸºç¡€è½¯ä»¶è¾ƒé•¿çš„å‡çº§è¿­ä»£å‘¨æœŸæ¥è¯´ï¼ŒOpenSSL 3.0 ä»ç„¶æ˜¯ä¸€ä¸ªå¾ˆæ–°çš„ç‰ˆæœ¬ï¼Œä¸€ä¸ªä¸»è¦åŸå› æ˜¯OpenSSL 3.0 å‘å¸ƒæ—¶é—´è¿˜è¾ƒçŸ­ï¼Œå…¶æ¬¡OpenSSL 3.0 åœ¨è½¯ä»¶æ¶æ„ä¸Šåšäº†è¾ƒå¤§çš„å˜åŠ¨ï¼Œéƒ¨åˆ†åŸæ¥è¢«å¹¿æ³›ä½¿ç”¨çš„å‡½æ•°è¢«æ ‡è®°ä¸ºäº†è¿‡æ—¶å‡½æ•°ï¼Œå¯¹äºç®—æ³•çš„ä½¿ç”¨æ–¹å¼ä¹Ÿæœ‰äº†æ–°çš„è§„åˆ™ï¼Œå„å‘è¡Œç‰ˆå‡ºäºç¨³å®šæ€§å’Œå…¼å®¹æ€§çš„è€ƒè™‘ï¼Œç›®å‰ç³»ç»Ÿé»˜è®¤å†…ç½®çš„ä¾ç„¶æ˜¯ 1.1.1 ç‰ˆæœ¬ã€‚ç”¨æˆ·è‹¥æ˜¯æƒ³ä½“éªŒ OpenSSL 3.0 çš„åŠŸèƒ½éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹ä»“åº“æˆ–è€…æ˜¯ä¸‹è½½æºç è‡ªè¡Œç¼–è¯‘ã€‚</p>
<p>Anolis OS 23 ç³»åˆ—çš„å‘è¡Œç‰ˆå·²ç‡å…ˆé›†æˆ OpenSSL 3.0 ä½œä¸ºé»˜è®¤çš„å¯†ç å­¦åº“ï¼Œå¹¶æä¾›ä¸ç¤¾åŒºç‰ˆæœ¬ä¸€è‡´çš„ä½“éªŒï¼Œç”¨æˆ·å¯ä»¥å‚è€ƒ OpenSSL ç¤¾åŒºæ‰‹å†Œä½¿ç”¨å®Œæ•´çš„å›½å¯†èƒ½åŠ›ã€‚</p>
<blockquote>
<p>ğŸŸ¢ <strong>Anolis 8.8 å†…ç½®å›½å¯†</strong></p>
</blockquote>
<p>ä½†ç›®å‰ä¸»æµçš„ Anolis OS 8.x ç³»åˆ—ï¼Œé»˜è®¤é¢„è£…çš„è¿˜æ˜¯ OpenSSL 1.1.1ï¼Œä¸€ç›´ä»¥æ¥ï¼ŒOpenSSL 1.1.1 éƒ½æ˜¯å›½å¯†çš„ä¸€ä¸ªé—æ†¾ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç—›ç‚¹ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ SM2 ç­¾åéªŒç­¾èƒ½åŠ›æ˜¯æœ‰ç¼ºé™·çš„ï¼Œä¹Ÿä¸æ”¯æŒå›½å¯†æ ‡å‡†çš„å¯è¾¨åˆ«æ ‡è¯†ï¼Œä½†è¿™ä¸ªç‰ˆæœ¬åˆæ˜¯ä¸»æµçš„å‘è¡Œç‰ˆæ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ï¼Œç”šè‡³åœ¨æŸäº›å‘è¡Œç‰ˆä¸­ï¼Œæ¯”å¦‚CentOSä¸­ï¼ŒSM3å’ŒSM4ç®—æ³•éƒ½æ˜¯è¢«åˆ æ‰çš„ã€‚é‰´äºä»¥ä¸ŠåŸå› ï¼Œåœ¨ Anolis OS 8.8 ä¸­ï¼Œåœ¨ä¿è¯å…¼å®¹æ€§å’Œç¨³å®šæ€§çš„å‰æä¸‹ï¼Œé¾™èœ¥ç¤¾åŒºåœ¨ç³»ç»Ÿé»˜è®¤é›†æˆçš„OpenSSL 1.1.1 ç‰ˆæœ¬ä¸Šæ”¯æŒäº†å®Œæ•´çš„SM2ç­¾åå’ŒéªŒç­¾èƒ½åŠ›ï¼Œå¹¶åšäº†å¼€æºï¼Œå‘è¡Œç‰ˆæœ¬rpmä¹Ÿé»˜è®¤å¼€å¯äº†SM3å’ŒSM4ç®—æ³•ï¼Œå¸¦ç»™ç”¨æˆ·å¼€ç®±å³ç”¨çš„å›½å¯†ä½¿ç”¨ä½“éªŒã€‚</p>
<p><strong><em>ä»£ç ä»“åº“ï¼š<a href="https://github.com/openanolis/openssl/tree/anolis_sm234">https://github.com/openanolis/openssl/tree/anolis_sm234</a></em></strong></p>
<p><strong><em>Anolis OS RPMï¼š<a href="https://gitee.com/src-anolis-os/openssl/tree/a8">https://gitee.com/src-anolis-os/openssl/tree/a8</a></em></strong></p>
<blockquote>
<p>ğŸŸ¢ <strong>ç”¨æˆ·æ‰‹å†Œ</strong></p>
</blockquote>
<p>æ ¹æ®è§„èŒƒ <code>GM/T 0003.2-2012</code> å’Œ <code>GM/T 0003.5-2012</code> çš„å®šä¹‰ï¼ŒSM2 ç®—æ³•ç­¾åæ—¶éœ€è¦ä¸€ä¸ªè®¡ç®—äº† Za çš„å“ˆå¸Œå€¼ï¼Œè¿™ä¸ªZaæ˜¯é€šè¿‡å›ºå®šçš„æ¤­åœ†æ›²çº¿å‚æ•°ã€å…¬é’¥æ•°æ®ä»¥åŠä¸€ä¸ªç”¨æˆ·è¾“å…¥çš„å¯è¾¨åˆ«IDç”Ÿæˆçš„ã€‚å› æ­¤ï¼Œå°±å¿…é¡»åœ¨ç”¨æˆ·ç•Œé¢æ·»åŠ ä¸€ä¸ªæŒ‡å®šç”¨æˆ·IDçš„å‚æ•°æ‰èƒ½æ”¯æŒå®Œæ•´çš„SM2ç­¾åå’ŒéªŒç­¾èƒ½åŠ›ï¼Œåœ¨é¾™èœ¥ç¤¾åŒºçš„OpenSSLåº“ä¸­ï¼Œé€šè¿‡ç‰¹æ®Šå‚æ•°å‘OpenSSLå†…éƒ¨ä¼ é€’è¯¥å‚æ•°ã€‚</p>
<p>å› æ­¤ï¼Œé¾™èœ¥ç¤¾åŒºä¸ºç­¾åå·¥å…·æ‰©å±•äº†<code>sigopt</code>å‚æ•°ï¼Œä¸ºéªŒç­¾å·¥å…·æ·»åŠ äº†<code>vfyopt</code>å‚æ•°æ¥æ”¯æ’‘ç”¨æˆ·ç•Œé¢çš„å·¥å…·ï¼ŒSM2çš„å¯è¾¨åˆ«æ ‡è¯†é€šè¿‡<code>distid</code>å­å‚æ•°æŒ‡å®šï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨<code>-sigopt &quot;distid:1234567812345678&quot;</code>åœ¨ç­¾åæ—¶æŒ‡å®šSM2çš„å¯è¾¨åˆ«æ ‡è¯†å€¼ï¼Œç»ˆç«¯ç”¨æˆ·å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå·¥å…·opensslæ¥è°ƒç”¨SM2çš„å®Œæ•´èƒ½åŠ›ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå…¶å®ƒå®Œå…¨å…¼å®¹ç¤¾åŒºçš„OpenSSL 1.1.1ï¼Œä»¥ä¸‹æ˜¯ä½¿ç”¨è¿™ä¸¤ä¸ªå‚æ•°çš„å…·ä½“ä¾‹å­ï¼Œ<code>1234567812345678</code> æ˜¯è§„èŒƒæ¨èä½¿ç”¨çš„ç”¨æˆ·IDï¼Œç”¨æˆ·å¯æ ¹æ®éœ€è¦è‡ªè¡ŒæŒ‡å®šã€‚</p>
<ul>
<li>
<p>ç”Ÿæˆä¸€ä¸ªè‡ªç­¾åçš„SM2æ ¹è¯ä¹¦</p>
<pre><code class="language-bash"># Generate a self signed root certificate

openssl ecparam -genkey -name SM2 -text -out ca.key

openssl req -verbose -new -days 10000 -x509 -sm3 \
    -sigopt &quot;distid:1234567812345678&quot; \
    -config genkey.conf -key ca.key -out ca.cert
</code></pre>
</li>
<li>
<p>ä»è¯ä¹¦ç”ŸæˆSM2ç®—æ³•çš„è¯ä¹¦è¯·æ±‚å¹¶éªŒè¯</p>
<pre><code class="language-bash"># Generate a certificate request from private key and verify it

openssl ecparam -genkey -name SM2 -text -out sm2.key

openssl req -verbose -new -sm3 \
    -sigopt &quot;distid:1234567812345678&quot; \
    -config genkey.conf -key sm2.key -out sm2.csr

openssl req -verbose -verify \
    -vfyopt &quot;distid:1234567812345678&quot; \
    -config genkey.conf -noout -text -in sm2.csr
</code></pre>
</li>
<li>
<p>ä½¿ç”¨SM2ç®—æ³•ç­¾åè¯ä¹¦è¯·æ±‚å¹¶éªŒè¯</p>
<pre><code class="language-bash"># Sign a SM2 certificate request using the CA certificate and verify it

openssl x509 -req -days 10000 -sm3 \
    -sigopt &quot;distid:1234567812345678&quot; \
    -vfyopt &quot;distid:1234567812345678&quot; \
    -CA ca.cert -CAkey ca.key -CAcreateserial \
    -extfile genkey.conf -extensions v3_ca \
    -in sm2.csr -out sm2.cert

openssl x509 -in sm2.cert -outform DER -out sm2.der

openssl verify -verbose -show_chain \
    -x509_strict -CAfile ca.cert sm2.cert
</code></pre>
</li>
</ul>
<p>å…¶ä¸­ genkey.confçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code>[ req ]
distinguished_name = req_distinguished_name
prompt = no
string_mask = utf8only
x509_extensions = v3_ca

[ req_distinguished_name ]
O = OpenAnolis-CA
CN = OpenAnolis certificate signing key
emailAddress = ca@openanolis-ca

[ v3_ca ]
basicConstraints=CA:TRUE
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid:always,issuer

[ skid ]
basicConstraints=CA:TRUE
subjectKeyIdentifier=12345678
authorityKeyIdentifier=keyid:always,issuer
</code></pre>
<blockquote>
<p>ğŸŸ¢ <strong>å¼€å‘æŒ‡å—</strong></p>
</blockquote>
<p>ä¸ºäº†æ”¯æŒSM2çš„ç­¾åéªŒç­¾èƒ½åŠ›ï¼Œé¾™èœ¥ç¤¾åŒºä¸º OpenSSL å†…éƒ¨çš„éªŒç­¾æ·»åŠ äº†ä¸‰ä¸ªæ–°çš„APIï¼š</p>
<pre><code class="language-c">int ASN1_item_verify_ctx(const ASN1_ITEM *it, X509_ALGOR *a,
                         ASN1_BIT_STRING *signature, void *asn, EVP_PKEY *pkey,
                         EVP_MD_CTX *ctx);

int X509_verify_ctx(X509 *a, EVP_PKEY *r, EVP_MD_CTX *ctx);

int X509_REQ_verify_ctx(X509_REQ *a, EVP_PKEY *r, EVP_MD_CTX *ctx);
</code></pre>
<p>å¼€å‘è€…é€šè¿‡ä»–ä»¬å¯ä»¥è°ƒç”¨å®Œæ•´çš„å›½å¯†ç­¾åéªŒç­¾èƒ½åŠ›ã€‚è¿™å‡ ä¸ªAPIæ‰©å±•äº†åŸæ¥ä¸å¸¦ ctx åç¼€çš„APIèƒ½åŠ›ï¼Œé€šè¿‡ctxå¯ä»¥é¢„å…ˆæŒ‡å®šé¢å¤–çš„å‚æ•°ï¼Œè¿™é‡Œä¸»è¦æ˜¯æŒ‡SM2ç®—æ³•çš„ç”¨æˆ·å¯è¾¨åˆ«æ ‡è¯†ï¼Œå…·ä½“ç”¨æ³•å¯å‚è€ƒappsç›®å½•é‡Œå·¥å…·çš„è°ƒç”¨æ–¹æ³•æˆ–è€…signç³»åˆ—çš„ç±»ä¼¼å‡½æ•°ã€‚</p>
<p><strong><em>X509_sign å‚è€ƒï¼š<a href="https://www.openssl.org/docs/man1.1.1/man3/X509_sign_ctx.html">https://www.openssl.org/docs/man1.1.1/man3/X509_sign_ctx.html</a></em></strong></p>
<footer>
<span class="copyright">Copyright Â© openanolis.cn 2023 all right reserved</span>
<pre><code class="footer-code">ä½œè€…: OpenAnolis
é“¾æ¥: https://gitee.com/anolis/whitebook-shangmi
æ¥æº: OpenAnolis
æœ¬æ–‡åŸåˆ›å‘å¸ƒäºã€ŒOpenAnolisã€,è½¬è½½è¯·æ³¨æ˜å‡ºå¤„,è°¢è°¢åˆä½œ!
</code></pre>
</footer>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="shangmi_sig.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="trusted_computing.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="shangmi_sig.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="trusted_computing.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
